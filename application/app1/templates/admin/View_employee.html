{% load static %}
<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.10.25/af-2.3.7/date-1.1.0/r-2.2.9/rg-1.1.3/sc-2.0.4/sp-1.3.0/datatables.min.css"/>
  <title>View Usrs</title>
  
  <style type="text/css">
    .btnAdd {
      text-align: right;
      width: 50%;
      height: auto;
    }
    
    input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    margin: 0; 
}
#example {
  font-family: Arial, Helvetica, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

#example td {
  border: 1px solid  #e6e6e6;
  padding: 8px;
}

#example tr:nth-child(even){background-color: #f2f2f2;}

#example tr:hover {background-color: #ddd;}

#example th {
  padding-top: 12px;
  padding-bottom: 12px;
  text-align: left;
  background-color: #ffffff;
  color: rgb(0, 0, 0);
}

  </style>
<style>
  input[type=number]::-webkit-inner-spin-button, 
input[type=number]::-webkit-outer-spin-button { 
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    margin: 0; 
}

</style>


</head>
<script src="{% static  'jquery-2.1.4.min.js' %}"></script>


 


<script>

  $(document).ready(function() {
  
    $.ajax({url:"/GetallUsers/",
            data:{
                
  
            },
        success:function(data1){
          // var assign2=JSON.parse(data)
          console.log(data1)
              $('#example').DataTable({
                  sScrollX: "100%" , sScrollXInner: "100%", 
                data: data1,
                columns:[
                {data: "Uid"},
                {data: "Fname"},
                {data: "Email"},
                {data: "Phone"},
                {data: "Address"},
                {data: "Batch"},
                {data: "Pemail"},
                {data: "Username"},
                {data: "Password"},
              

                 
                ],
     
                "aoColumnDefs": [
             {
                  "aTargets": [9],
                  "mRender": function () {
                      return '<a    class="btn btn-success btn-sm" id="capbtn" >Capture face</a> <a href="#!" data-id="" data-bs-toggle="modal" data-bs-target="#addUserModal"   class="btn btn-success btn-sm" id="editbtn" >Edit</a>  <a href="#!" data-bs-toggle="modal" " data-bs-target="#exampleModal" class="btn btn-danger btn-sm" id="deletebtn">Delete</a>';
                  },
         
              }
           ]
               });
            },
            error: function(error){
              console.log(error);
              }
            });
      });
  
  
  
    </script>
<body style="background-image: url(static/assets/images/auth/register.jpg);background-size: 1200px 600px;">

    
  <div class="container-fluid">
    <h2 class="text-center">View Students</h2>
    <p class="datatable design text-center">You can update or remove Students</p>
    <!-- <div class="row"> -->
      <!-- <div class="container"> -->
        
       <!-- <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8"> -->
         <table id="example" class="table">
          <thead>
            <tr>
                <th>User ID</th>
                <th>Name</th>
               <th>Email</th>
               <th>Phone</th>
               <th> Address</th>
               <th>Batch</th>
               <th>Parent email</th>
             <th>Username</th>
             <th>Password</th>
            
             <th>Edit/Delete</th>
         
         
             </tr>
          </thead>
          <tbody>
         
          </tbody>
          
        </table>
      <!-- </div>
      <div class="col-md-2"></div> -->
    <!-- </div> -->
  </div>
<!-- </div>
</div> -->
<!-- Optional JavaScript; choose one of the two! -->
<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.10.25/af-2.3.7/date-1.1.0/r-2.2.9/rg-1.1.3/sc-2.0.4/sp-1.3.0/datatables.min.js"></script>
<!-- Option 2: Separate Popper and Bootstrap JS -->

  
 <!-- Modal -->
 <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Delete User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="updateUser" >
          <input type="hidden" name="id" id="did" value="">
          <h5 id="cnfm"></h5>
          <br>
            <button type="submit" id="dtbtn" class="btn btn-primary" style="background-color: tomato;border-color: tomato;">Yes</button> 
            <button type="button"  class="btn btn-secondary" data-bs-dismiss="modal">No</button>

        </form> 

      </div>
      
    </div>
  </div>
</div>
<!-- Add user Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Update User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
            <input type="hidden" name="userid" id="userid" >
          <div class="mb-3 row">
            <label for="addUserField" class="col-md-3 form-label">Name</label>
            <div class="col-md-9">
              <input type="text" class="form-control" id="upd_name" name="name" >
            </div>
          </div>
          <div class="mb-3 row">
            <label for="addEmailField" class="col-md-3 form-label">Email</label>
            <div class="col-md-9">
              <input type="email" class="form-control" id="upd_email" name="email">
            </div>
          </div>
          <div class="mb-3 row">
            <label for="addMobileField" class="col-md-3 form-label">Phone</label>
            <div class="col-md-9">
              <input type="text" class="form-control" id="upd_phone" name="mobile">
            </div>
          </div>
         
          <div class="mb-3 row">
            <label for="addCityField" class="col-md-3 form-label">Address</label>
            <div class="col-md-9">
              <input type="text" class="form-control" id="upd_addr" name="addr">
            </div>
          </div>
          
        
         
          
          <div class="mb-3 row">
            <label for="addCityField" class="col-md-3 form-label">Batch</label>
            <div class="col-md-9">
                <input type="text" class="form-control" id="jsec" >
            </div>
          </div>
             
          <div class="mb-3 row">
            <label for="addCityField" class="col-md-3 form-label">Parent email</label>
            <div class="col-md-9">
                <input type="text" class="form-control" id="bsal" >
            </div>
          </div>
          <div class="mb-3 row">
            <label for="addCityField" class="col-md-3 form-label">Username</label>
            <div class="col-md-9">
              <input type="text" class="form-control" id="upd_username" name="unm">
            </div>
          </div>
          <div class="mb-3 row">
            <label for="addCityField" class="col-md-3 form-label">Password</label>
            <div class="col-md-9">
              <input type="text" class="form-control" id="upd_psw" name="psw">
            </div>
          </div>
          <div class="text-center">
            <button type="submit" id="saveuser" class="btn btn-primary">SAVE</button>
          </div>
       
      </div>
    
    </div>
  </div>
</div>

<script>
$(document).ready(function(){
var emailflag=0;
var phoneflag=0;
  $("#saveuser").click(function(){
    
    console.log("email flag-->"+emailflag+"  phoneflag-->"+phoneflag)
    uid=$('#userid').val();
    fname=$('#upd_name').val();
    email=$('#upd_email').val();
    phone=$('#upd_phone').val();
    addr=$('#upd_addr').val();
    jsec=$('#jsec').val();
    bsal=$('#bsal').val();
    uname=$('#upd_username').val();
    pswrd=$('#upd_psw').val();
    
      if(fname==""){
          alert("Please enter your Name first!");
      }
     
    else if(email=='')
		{
			alert('Please enter your user email id');
		}
		
    else if(phone==""){
      alert("Please enter phone number")
    }
    else if(phone==""){
      alert("Please enter phone number")
    }
    else if(phone.length!=10){
      alert("Phone number must be 10 digit number")
    }
    
    else if(addr==""){
      alert("Please enter address of user")
    }
    else if(jsec==""){
      alert("Please senter job section")
    }
    else if(bsal==""){
      alert("Please basic salary")
    }
   
    else if(uname==""){
      alert("Please enter username")
    }
    
    else if(uname.length<5){
      alert("Length of username should be greater than 5")
    }
    else if(pswrd==""){
      alert("Enter  password")
    }
    
      else{
        console.log(uid+fname+email+phone+addr+jsec+bsal+uname+pswrd)
          $.ajax({url:"/Updatestudent/",
          data:{
              "uid":uid,
              "fname":fname,
              "email":email,
              "phone":phone,
              "addr":addr,
              "jsec":jsec,
              "bsal":bsal,
     
              "uname":uname,
              "pswrd":pswrd,
              

          },
      success:function(da){
                 
             if(da.info=="yes")  {
               alert("Saved Sucessfully!!")
           
             }  
             else{
               alert("Oops!!! some error occured\nTry again later")
             }
          
      }
    });
      }
      
    
  }); 


  $("#dtbtn").click(function(){
    
    uid=$('#did').val();
    console.log(uid)
 
          $.ajax({url:"/Delete_employee/",
          data:{
              "uid":uid,
              

          },
      success:function(da){
                 
             if(da.info=="no")  {
               alert("Oops!!! some error occured\nTry again later")
               
             }  
             else{
              alert("Deleted  Sucessfully!!")
             
             }
          
      }
    });
      
      
    
  }); 

// code to read selected table row cell data (values).
$("#example").on('click','#editbtn',function(){
    
     // get the current row
     var currentRow=$(this).closest("tr"); 
   
     var userid=currentRow.find("td:eq(0)").text(); // get current row 1st TD value
     var name=currentRow.find("td:eq(1)").text(); // get current row 2nd TD
     var email=currentRow.find("td:eq(2)").text(); // get current row 3rd TD
     var phone=currentRow.find("td:eq(3)").text()
     var addr=currentRow.find("td:eq(4)").text();
    var jsec=currentRow.find("td:eq(5)").text(); 
    
    var bsal=currentRow.find("td:eq(6)").text()
   
    var username=currentRow.find("td:eq(7)").text(); 
    var password=currentRow.find("td:eq(8)").text();
    document.getElementById("userid").setAttribute('value',userid);
     document.getElementById("upd_name").setAttribute('value',name);
     document.getElementById("upd_email").setAttribute('value',email);
     document.getElementById("upd_phone").setAttribute('value',phone);
     document.getElementById("upd_addr").setAttribute('value',addr);
     document.getElementById("jsec").setAttribute('value',jsec);
     document.getElementById("bsal").setAttribute('value',bsal);
     
     
     document.getElementById("upd_username").setAttribute('value',username);
     document.getElementById("upd_psw").setAttribute('value',password);
    //  alert(data);
});

$("#example").on('click','#deletebtn',function(){
    
    // get the current row
    var currentRow=$(this).closest("tr"); 
  
    var userid=currentRow.find("td:eq(0)").text(); // get current row 1st TD value
    var name=currentRow.find("td:eq(1)").text(); // get current row 2nd TD
   document.getElementById("did").setAttribute('value',userid);
    document.getElementById("cnfm").innerHTML="Are you really want to delete "+name+" ?"
   
});

$("#example").on('click','#capbtn',function(){
    
    // get the current row
    var currentRow=$(this).closest("tr"); 
  
    var userid=currentRow.find("td:eq(7)").text(); // get current row 1st TD value
    var name=currentRow.find("td:eq(1)").text(); // get current row 2nd TD
  alert(userid)
  $.ajax({url:"/getfaceusid/",
          data:{
              
              "userid":userid,
  
          },
      success:function(da){
  
            //  if(da.info=="yes"){
            //    alert("Leave Approved")
               window.location.href="{% url 'Admin_cap_img' %}"
    
            //  }
            //  else{
            //    alert("Oops Some error occured!!")
               
            //  }
          
      }
    });
   
});


$("#saveuser").on('click','#deletebtn',function(){
    
    // get the current row
    var currentRow=$(this).closest("tr"); 
  
    var userid=currentRow.find("td:eq(0)").text(); // get current row 1st TD value
    var name=currentRow.find("td:eq(1)").text(); // get current row 2nd TD
   document.getElementById("did").setAttribute('value',userid);
    document.getElementById("cnfm").innerHTML="Are you really want to delete "+name+" ?"
   
});

});

</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.10.25/af-2.3.7/date-1.1.0/r-2.2.9/rg-1.1.3/sc-2.0.4/sp-1.3.0/datatables.min.js"></script>
  
<!-- 
<script type="text/javascript">
    var table = $('#example').DataTable();
  </script> -->
</body>
</html>



